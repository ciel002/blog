{% extends "home/base.html" %}
{% block main %}
    <div class="container">
        <div class="row">
            <div class="u_header">
                <h1>个人中心</h1>
            </div>
            <div class="u_main clearfix">
                <div class="u_nav col-md-3">
                    {% include 'home/user_sidenav.html' %}
                </div>
                <div class="col-md-9 u_mainbody">
                    <div class="u_tab">
                        <div class="u_title">
                            <p>个人信息</p>
                        </div>
                        <div class="u_info clearfix">
                            <div class="u_info_avatar text-center pull-left">
                                {% if user.avatar %}
                                    <img id="current_avatar" src="{{ url_for('tool.load_edit_avatar', uid=user.id) }}"
                                         class="img-responsive" alt="头像">
                                {% else %}
                                    <img id="current_avatar" src="{{ url_for('static', filename='imgs/default-logo.gif') }}"
                                         class="img-responsive" alt="头像">
                                {% endif %}
                                <form action="" method="post" id="avatar_form" style="margin-top: 20px">
                                    <input id="avatar_upload" type="file" class="file" data-show-preview="false"
                                           style="display: none"/>
                                    <input type="button" class="btn btn-default" id="change_avatar" value="更换头像">
                                </form>
                            </div>
                            <div class="u_info_detail">
                                <div class="u_info_name">
                                    <p><b>{{ user.name }}</b>
                                        <button>修改昵称</button>
                                    </p>
                                </div>
                                <div class="u_info_group">
                                    <p>{{ user.groupname }}</p>
                                </div>
                                <div class="u_info_time">
                                    <p>注册时间:{{ user.register_time }}</p>
                                    <p>上次登录时间:{{ user.last_login_time }}</p>
                                </div>
                                <div class="u_info_post">
                                    <p>文章数量:{{ user.post_count }}</p>
                                    <p>评论数量:{{ user.comment_count }}</p>
                                    <p>回复数量:{{ user.reply_count }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="u_tab">
                        <div class="u_title">
                            <p>账号绑定</p>
                        </div>
                        <div class="u_bind clearfix">
                            <div class="u_bind_item col-sm-6">
                                {% if user.email %}
                                    <div class="u_bind_icon binded_email_icon"></div>
                                    <div class="pull-left">
                                        <p class="u_bind_title">邮箱绑定
                                            <small>({{ user.email }})</small>
                                        </p>
                                        <p class="u_bind_subtitle">您可以使用邮箱来保障您的账号安全</p>
                                    </div>
                                    <a href="{{ url_for('home.alter_email') }}"
                                       class="u_binded_button btn btn-default btn-circle">修改邮箱</a>
                                {% else %}
                                    <div class="u_bind_icon bind_email_icon"></div>
                                    <div class="pull-left">
                                        <p class="u_bind_title">邮箱绑定</p>
                                        <p class="u_bind_subtitle">您可以使用邮箱来保障您的账号安全</p>
                                    </div>
                                    <a class="u_bind_button btn btn-default btn-circle">修改邮箱</a>
                                {% endif %}
                            </div>
                            <div class="u_bind_item col-sm-6">
                                {% if user.phone %}
                                    <div class="u_bind_icon binded_phone_icon"></div>
                                    <div class="pull-left">
                                        <p class="u_bind_title">手机绑定
                                            <small>({{ user.phone }})</small>
                                        </p>
                                        <p class="u_bind_subtitle">您可以享受手机相关的安全及提醒服务</p>
                                    </div>
                                    <a class="u_binded_button btn btn-default btn-circle">修改手机</a>
                                {% else %}
                                    <div class="u_bind_icon bind_phone_icon"></div>
                                    <div class="pull-left">
                                        <p class="u_bind_title">手机绑定</p>
                                        <p class="u_bind_subtitle">您可以享受手机相关的安全及提醒服务</p>
                                    </div>
                                    <a class="u_bind_button btn btn-default btn-circle">修改手机</a>
                                {% endif %}
                            </div>

                            <div class="u_bind_item col-sm-6">
                                {% if user.qq %}
                                    <div class="u_bind_icon binded_qq_icon"></div>
                                    <div class="pull-left">
                                        <p class="u_bind_title">QQ绑定
                                            <small>({{ user.qq }})</small>
                                        </p>
                                        <p class="u_bind_subtitle">绑定QQ帐号，使用QQ帐号便捷登录</p>
                                    </div>
                                    <a class="u_binded_button btn btn-default btn-circle">修改QQ</a>
                                {% else %}
                                    <div class="u_bind_icon bind_qq_icon"></div>
                                    <div class="pull-left">
                                        <p class="u_bind_title">QQ绑定</p>
                                        <p class="u_bind_subtitle">绑定QQ帐号，使用QQ帐号便捷登录</p>
                                    </div>
                                    <a class="u_bind_button btn btn-default btn-circle">修改QQ</a>
                                {% endif %}

                            </div>
                            <div class="u_bind_item col-sm-6">
                                {% if user.wechat %}
                                    <div class="u_bind_icon binded_wechat_icon"></div>
                                    <div class="pull-left">
                                        <p class="u_bind_title">微信绑定
                                            <small>({{ user.wechat }})</small>
                                        </p>
                                        <p class="u_bind_subtitle">绑定微信帐号，使用微信帐号便捷登录</p>
                                    </div>
                                    <a class="u_binded_button btn btn-default btn-circle">修改微信</a>
                                {% else %}
                                    <div class="u_bind_icon bind_wechat_icon"></div>
                                    <div class="pull-left">
                                        <p class="u_bind_title">微信绑定</p>
                                        <p class="u_bind_subtitle">绑定微信帐号，使用微信帐号便捷登录</p>
                                    </div>
                                    <a class="u_bind_button btn btn-default btn-circle">修改微信</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="u_tab">
                        <div class="u_title">
                            <p>账号设置</p>
                        </div>
                        <div class="u_bind clearfix">
                            <div class="u_bind_item col-sm-6">
                                <div class="u_bind_icon binded_password_icon"></div>
                                <div class="pull-left">
                                    <p class="u_bind_title">密码强度</p>
                                    <p class="u_bind_subtitle">目前您的密码强度中，请修改提升强度</p>
                                </div>
                                <a href="{{ url_for('home.alter_password') }}"
                                   class="u_binded_button btn btn-default btn-circle">修改密码</a>
                            </div>
                            <div class="u_bind_item col-sm-6">
                                <div class="u_bind_icon bind_delete_icon"></div>
                                <div class="pull-left">
                                    <p class="u_bind_title">注销账号</p>
                                    <p class="u_bind_subtitle">注销帐号相关信息，请谨慎操作</p>
                                </div>
                                <a class="u_bind_button btn btn-default btn-circle">注销</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    <script>
        $('#change_avatar').on("click", function () {
            $("#avatar_upload").click();
        });

        $("#avatar_upload").change(function () {
            var filePath = $(this).val();
            if (filePath.indexOf("jpg") != -1 || filePath.indexOf("png") != -1) {
                var f = document.getElementById('avatar_upload').files[0];
                var form = new FormData();
                form.append("avatar", f);
                $.ajax({
                    type: "POST",
                    url: "{{ url_for("admin.alter_user_avatar", uid=user.id) }}",
                    dataType: "json",
                    cache: false,
                    processData: false,
                    contentType: false,
                    data: form,
                    success: function (res) {
                        $("#current_avatar").attr("src", "{{ url_for('tool.load_edit_avatar', uid=user.id) }}" + "?" + Math.random());
                        console.log(res);
                    },
                    error: function (res) {
                        console.log("失败");
                    }
                });
            } else {
                alert("您未上传文件，或者您上传文件类型有误！");
                return false
            }
        });
    </script>
{% endblock %}